---
import Layout from "../layouts/Layout.astro"
import Main from "../components/Main.astro"
import Weather from "../components/Weather.astro"
import Dropdown from "../components/Dropdown.astro"

type Region = 'Pacific Northwest' | 'West Mountain' | 'West North Central' | 'West South Central' | 'East South Central' | 'East North Central' | 'Middle Atlantic'
| 'South Atlantic' | 'North East' ;

let areaItems : Region[] = [
  'Pacific Northwest', 'West Mountain', 'West North Central', 'West South Central',
  'East South Central', 'East North Central', 'Middle Atlantic', 'South Atlantic', 'North East'
];

const regions: Record<Region, { name: string; code: string; }[]> = {
  'Pacific Northwest': [{ name: 'Seattle', code: 'Seattle' }, { name: 'Portland', code: 'Portland' }],
  'West Mountain': [{ name: 'Denver', code: 'Denver' }, { name: 'Salt Lake City', code: 'SaltLakeCity' }],
  'West North Central': [{ name: 'Minneapolis', code: 'Minneapolis' }, { name: 'Kansas City', code: 'KansasCity' }],
  'West South Central': [],
  'East South Central': [], 
  'East North Central': [], 
  'Middle Atlantic': [], 
  'South Atlantic': [], 
  'North East': [] 
};

let selectedRegion: Region = 'Pacific Northwest';
let cities = regions[selectedRegion];

---

<Layout title = "Weather Page">
    <Main>
     
        <Dropdown items={areaItems} />
            <div id="weather-container">
                <Weather areaName={selectedRegion} cities={cities}/>
            </div>
    </Main>


</Layout>

<script>

type Region = 'Pacific Northwest' | 'West Mountain' | 'West North Central' | 'West South Central' | 'East South Central' | 'East North Central' | 'Middle Atlantic'
| 'South Atlantic' | 'North East' ;

const regions: Record<Region, { name: string; code: string; }[]> = {
  'Pacific Northwest': [{ name: 'Seattle', code: 'Seattle' }, { name: 'Portland', code: 'Portland' }],
  'West Mountain': [{ name: 'Denver', code: 'Denver' }, { name: 'Salt Lake City', code: 'SaltLakeCity' }],
  'West North Central': [{ name: 'Minneapolis', code: 'Minneapolis' }, { name: 'Kansas City', code: 'KansasCity' }],
  'West South Central': [],
  'East South Central': [], 
  'East North Central': [], 
  'Middle Atlantic': [], 
  'South Atlantic': [], 
  'North East': [] 
};

let selectedRegion: Region = 'Pacific Northwest';

let citiesArray: { name: string; code: string; }[] = [];



    function onRegionSelect(region: string) {
        const typedRegion = region as Region;
        selectedRegion = typedRegion;
        const cities = regions[typedRegion];

        console.log(cities)
        citiesArray = [...cities];
        console.log(citiesArray)

        const weatherContainer = document.getElementById('weather-container');
        if (weatherContainer) {
            weatherContainer.innerHTML = '';
            const weatherComponent = document.createElement('weather-component'); 
            weatherComponent.setAttribute('area-name', region);
            weatherComponent.setAttribute('cities', citiesArray)
            
        weatherContainer.appendChild(weatherComponent);
        console.log(weatherContainer);
    } else {
        console.error("Weather container not found!");
    }
}

    

    document.addEventListener('DOMContentLoaded', () => {
        const dropdown = document.querySelector('.dropdown') as HTMLElement | null;

        if (dropdown) {
            dropdown.addEventListener('regionSelected', (event) => {
                const selectedRegion = (event as CustomEvent).detail;
                onRegionSelect(selectedRegion);
                console.log(selectedRegion)
            });
        } else {
            console.error("Dropdown not found!");
        }
    });
</script>
  



<style>
    #weather-container {
    margin-top: 20px; /* Space above the weather component */
    padding: 20px; /* Inner spacing */
    border: 1px solid #ccc; /* Light border around the container */
    border-radius: 8px; /* Rounded corners */
    background-color: #6c6262; /* Light background color */
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
    height: 300px;
}
</style>