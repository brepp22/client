---
interface Article {
    title: string;
    abstract: string;
    url: string;
    multimedia: { url: string }[];
    byline: string;
}

interface ApiResponse {
    copyright: string;
    section: string;
    last_updated: string;
    results: Article[];
}

// Fetch the articles from the API
const fetchApiData = async (): Promise<ApiResponse | null> => {
    try {
        const response = await fetch(
            `https://api.nytimes.com/svc/topstories/v2/us.json?api-key=OgPNdz8zjrViHUCTW0tyCbiVpI5UkEhA`
        );
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching API data:', error);
        return null;
    }
};

// Fetch API data during server-side rendering
const apiData = await fetchApiData();
const articles = apiData?.results.slice(0, 10) || [];
---

<html>
<head>
    <title>Top 10 Articles</title>
</head>
<body>
    <h1 class="font-mono text-3xl">Top 10 Latest New York Times Articles</h1>
    <p class="text-2xl font-mono pb-10"><strong>Section:</strong> {apiData?.section || ''}</p>
    {articles.length > 0 ? (
        <section>
            {articles.map((article) => (
                <div class="article font-mono pb-8">
                    <h2 class="text-2xl"><strong>{article.title}</strong></h2>
                    <p class="pb-4">{article.byline}</p>
                    <p class="text-xl pb-8">{article.abstract}</p>
                    {article.multimedia && article.multimedia.length > 0 ? (
                        <img src={article.multimedia[0].url} alt={article.title} />
                    ) : (
                        <p class="text-xl font-mono">No image available</p>
                    )}
                    <a class="mt-8 block" href={article.url} target="_blank"><strong>Read more</strong></a>
                </div>
            ))}
        </section>
    ) : (
        <p class="font-mono text-2xl">No articles available at the moment.</p>
    )}
    <footer class="font-mono">
        <p>{apiData?.copyright || 'All Rights Reserved.'}</p>
    </footer>
</body>
</html>

<style>
    .article {
        margin-bottom: 2rem;
    }
    .article img {
        width: 600px;
        height: 400px;
        margin-left: 30px;
   
    }
    footer {
        margin-top: 2rem;
        font-size: 0.9rem;
        color: gray;
    }
   
</style>