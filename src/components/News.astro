---
interface Article {
    title: string;
    abstract: string;
    url: string;
    multimedia: { url: string }[];
}

interface ApiResponse {
    copyright: string;
    section: string;
    last_updated: string;
    results: Article[];
}

// Fetch the articles from the API
const fetchApiData = async (): Promise<ApiResponse | null> => {
    try {
        const response = await fetch(
            `https://api.nytimes.com/svc/topstories/v2/us.json?api-key=OgPNdz8zjrViHUCTW0tyCbiVpI5UkEhA`
        );
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        const data = await response.json();
        return data;
    } catch (error) {
        console.error('Error fetching API data:', error);
        return null;
    }
};

// Fetch API data during server-side rendering
const apiData = await fetchApiData();
const articles = apiData?.results.slice(0, 5) || [];
---

<html>
<head>
    <title>Top 5 Articles</title>
    <style>
        .article {
            margin-bottom: 2rem;
        }
        .article img {
            max-width: 80%;
            height: auto;
            display: block;
        }
        footer {
            margin-top: 2rem;
            font-size: 0.9rem;
            color: gray;
        }
    </style>
</head>
<body>
    <h1>Top 5 Latest Articles</h1>
    <p><strong>Section:</strong> {apiData?.section || 'Unknown'}</p>
    {articles.length > 0 ? (
        <section>
            {articles.map((article) => (
                <div class="article">
                    <h2>{article.title}</h2>
                    <p>{article.abstract}</p>
                    {article.multimedia && article.multimedia.length > 0 ? (
                        <img src={article.multimedia[0].url} alt={article.title} />
                    ) : (
                        <p>No image available</p>
                    )}
                    <a href={article.url} target="_blank">Read more</a>
                </div>
            ))}
        </section>
    ) : (
        <p>No articles available at the moment.</p>
    )}
    <footer>
        <p>{apiData?.copyright || 'All Rights Reserved.'}</p>
    </footer>
</body>
</html>
